from typing import Set

from disk.icmp.base_allocator import BaseAllocator
from disk.icmp.data_ip import IPHost


class BalancedAllocator(BaseAllocator):

    def allocate_hosts_group(self, num=3) -> Set[IPHost]:
        ret: Set[IPHost] = set()
        for x in range(num):
            h = None
            if x == 0:
                h = self._host_manager.get_fastest_free_host()
            else:
                h = self._host_manager.get_slowest_free_host()
            ret.add(IPHost(addr=h['ip'], last_latency_ms=h['ms']))
            self._host_manager.set_host_as_used(h['ip'])
        return ret
