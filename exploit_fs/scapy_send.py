from scapy.all import IP, ICMP, send, sniff

def send_icmp_message(destination, message):
    ip_packet = IP(dst=destination)
    icmp_packet = ICMP() / message
    packet = ip_packet / icmp_packet
    send(packet)

def handle_icmp_packet(packet):
    if packet.haslayer(ICMP):
        icmp_payload = packet[ICMP].load.decode('utf-8')
        print("Received message:", icmp_payload)

def main():
    destination = "127.0.0.1"  # Replace with the destination IP
    message = "Hello, world!"

    send_icmp_message(destination, message)

    # Sniff for incoming ICMP packets
    sniff(filter="icmp", prn=handle_icmp_packet)

if __name__ == "__main__":
    main()